<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æµ‹è¯•æ‰©å±•ä¸Šä¸‹æ–‡å¤±æ•ˆä¿®å¤</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.8;
    }
    .test-section {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .test-title {
      color: #667eea;
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 10px;
    }
    .test-description {
      color: #666;
      margin-bottom: 15px;
    }
    .test-steps {
      background: white;
      padding: 15px;
      border-radius: 6px;
      border-left: 4px solid #667eea;
    }
    .step {
      margin-bottom: 8px;
    }
    .step-number {
      background: #667eea;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      margin-right: 8px;
    }
    .highlight {
      background: #fff3cd;
      padding: 2px 4px;
      border-radius: 3px;
      font-weight: 500;
    }
    .success {
      color: #28a745;
      font-weight: 500;
    }
    .warning {
      color: #ffc107;
      font-weight: 500;
    }
    .error {
      color: #dc3545;
      font-weight: 500;
    }
    .test-content {
      background: white;
      padding: 20px;
      border-radius: 8px;
      border: 2px dashed #667eea;
      margin: 20px 0;
      font-size: 16px;
      line-height: 1.8;
    }
    .test-word {
      background: #e3f2fd;
      padding: 2px 4px;
      border-radius: 3px;
      font-weight: 600;
      color: #1976d2;
    }
    .code-block {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 4px;
      padding: 10px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 12px;
      color: #495057;
      margin: 10px 0;
    }
    .reload-button {
      background: #667eea;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      margin: 10px 5px;
    }
    .reload-button:hover {
      background: #5a6fd8;
    }
  </style>
</head>
<body>
  <h1>ğŸ”§ æ‰©å±•ä¸Šä¸‹æ–‡å¤±æ•ˆä¿®å¤æµ‹è¯•</h1>
  
  <div class="test-section">
    <div class="test-title">ğŸ“‹ ä¿®å¤è¯´æ˜</div>
    <div class="test-description">
      æœ¬æ¬¡æ›´æ–°ä¸»è¦è§£å†³äº†<span class="highlight">"Extension context invalidated"</span>é”™è¯¯ï¼Œè¯¥é”™è¯¯é€šå¸¸åœ¨æ‰©å±•é‡è½½ã€æ›´æ–°æˆ–é•¿æ—¶é—´è¿è¡Œåå‡ºç°ã€‚ç°åœ¨å³ä½¿æ‰©å±•ä¸Šä¸‹æ–‡å¤±æ•ˆï¼Œæ”¶è—åŠŸèƒ½ä»èƒ½æ­£å¸¸å·¥ä½œï¼Œæ•°æ®ä¼šä¿å­˜åˆ°å†…å­˜ä¸­å¹¶åœ¨ä¸Šä¸‹æ–‡æ¢å¤åè‡ªåŠ¨åŒæ­¥ã€‚
    </div>
  </div>

  <div class="test-section">
    <div class="test-title">ğŸ› åŸå§‹é—®é¢˜</div>
    <div class="test-description">
      <strong>é”™è¯¯ä¿¡æ¯ï¼š</strong>
      <div class="code-block">
        Error: Extension context invalidated.<br>
        at saveWordsToStorage (content.js:149:32)<br>
        at saveWord (content.js:103:11)<br>
        at toggleFavorite (content.js:886:11)
      </div>
      <strong>é—®é¢˜å½±å“ï¼š</strong> ç”¨æˆ·ç‚¹å‡»æ”¶è—æŒ‰é’®æ—¶åŠŸèƒ½å¤±æ•ˆï¼Œæ— æ³•ä¿å­˜å•è¯ã€‚
    </div>
  </div>

  <div class="test-section">
    <div class="test-title">ğŸ”§ ä¿®å¤æªæ–½</div>
    <div class="test-steps">
      <div class="step">
        <span class="step-number">1</span>
        <strong>æ‰©å±•ä¸Šä¸‹æ–‡æ£€æŸ¥</strong> - æ·»åŠ isExtensionContextValid()å‡½æ•°æ£€æµ‹ä¸Šä¸‹æ–‡çŠ¶æ€
      </div>
      <div class="step">
        <span class="step-number">2</span>
        <strong>å®‰å…¨å­˜å‚¨åŒ…è£…å™¨</strong> - safeStorageOperation()è‡ªåŠ¨å¤„ç†ä¸Šä¸‹æ–‡å¤±æ•ˆ
      </div>
      <div class="step">
        <span class="step-number">3</span>
        <strong>æ™ºèƒ½æ•°æ®ä¿æŠ¤</strong> - ä¸Šä¸‹æ–‡å¤±æ•ˆæ—¶æ•°æ®ä»ä¿å­˜åˆ°å†…å­˜
      </div>
      <div class="step">
        <span class="step-number">4</span>
        <strong>è‡ªåŠ¨æ¢å¤åŒæ­¥</strong> - ä¸Šä¸‹æ–‡æ¢å¤åè‡ªåŠ¨åŒæ­¥å†…å­˜æ•°æ®
      </div>
      <div class="step">
        <span class="step-number">5</span>
        <strong>ä¼˜é›…UIæ›´æ–°</strong> - å³ä½¿å­˜å‚¨å¤±è´¥UIä»æ­£ç¡®æ›´æ–°
      </div>
    </div>
  </div>

  <div class="test-section">
    <div class="test-title">ğŸ§ª æµ‹è¯•æ­¥éª¤</div>
    <div class="test-steps">
      <div class="step">
        <span class="step-number">1</span>
        åœ¨ä¸‹æ–¹æµ‹è¯•å†…å®¹ä¸­é€‰ä¸­è‹±æ–‡å•è¯å¹¶æ”¶è—
      </div>
      <div class="step">
        <span class="step-number">2</span>
        ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®é‡è½½æ‰©å±•ï¼Œæ¨¡æ‹Ÿä¸Šä¸‹æ–‡å¤±æ•ˆ
      </div>
      <div class="step">
        <span class="step-number">3</span>
        é‡è½½åç«‹å³å°è¯•æ”¶è—æ–°å•è¯ï¼Œè§‚å¯Ÿæ˜¯å¦æ­£å¸¸å·¥ä½œ
      </div>
      <div class="step">
        <span class="step-number">4</span>
        æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°ï¼Œç¡®è®¤é”™è¯¯å¤„ç†æ—¥å¿—
      </div>
      <div class="step">
        <span class="step-number">5</span>
        ç­‰å¾…5-10ç§’ï¼Œè§‚å¯Ÿæ•°æ®æ˜¯å¦è‡ªåŠ¨åŒæ­¥
      </div>
    </div>
  </div>

  <div class="test-section">
    <div class="test-title">ğŸ® æµ‹è¯•æ§åˆ¶</div>
    <div class="test-description">
      <button class="reload-button" onclick="reloadExtension()">é‡è½½æ‰©å±•</button>
      <button class="reload-button" onclick="checkConsole()">æ£€æŸ¥æ§åˆ¶å°</button>
      <button class="reload-button" onclick="testRecovery()">æµ‹è¯•æ¢å¤æœºåˆ¶</button>
    </div>
  </div>

  <div class="test-section">
    <div class="test-title">ğŸ“ æµ‹è¯•å†…å®¹</div>
    <div class="test-content">
      <p>Test the <span class="test-word">extension</span> context invalidation fix. Try to <span class="test-word">favorite</span> these words before and after reloading the extension.</p>
      
      <p>Words to test: <span class="test-word">important</span>, <span class="test-word">development</span>, <span class="test-word">intelligent</span>, <span class="test-word">automatic</span>.</p>
      
      <p>The <span class="test-word">recovery</span> mechanism should <span class="test-word">synchronize</span> data automatically when the extension context is restored.</p>
      
      <p>Additional test words: <span class="test-word">beautiful</span>, <span class="test-word">successful</span>, <span class="test-word">performance</span>, <span class="test-word">reliability</span>.</p>
    </div>
  </div>

  <div class="test-section">
    <div class="test-title">âœ… é¢„æœŸè¡Œä¸º</div>
    <div class="test-steps">
      <div class="step">
        <span class="success">âœ“</span> æ‰©å±•é‡è½½å‰æ”¶è—åŠŸèƒ½æ­£å¸¸å·¥ä½œ
      </div>
      <div class="step">
        <span class="success">âœ“</span> æ‰©å±•é‡è½½åç«‹å³æ”¶è—ä»èƒ½æˆåŠŸï¼ˆä¿å­˜åˆ°å†…å­˜ï¼‰
      </div>
      <div class="step">
        <span class="success">âœ“</span> æ§åˆ¶å°æ˜¾ç¤º"æ‰©å±•ä¸Šä¸‹æ–‡å¤±æ•ˆï¼Œå•è¯å·²ä¿å­˜åˆ°å†…å­˜"
      </div>
      <div class="step">
        <span class="success">âœ“</span> 5-10ç§’åæ˜¾ç¤º"æ‰©å±•ä¸Šä¸‹æ–‡å·²æ¢å¤ï¼Œå°è¯•åŒæ­¥æ•°æ®"
      </div>
      <div class="step">
        <span class="success">âœ“</span> æ•°æ®åŒæ­¥æˆåŠŸï¼Œæ‰€æœ‰æ”¶è—çš„å•è¯éƒ½è¢«ä¿å­˜
      </div>
      <div class="step">
        <span class="success">âœ“</span> UIçŠ¶æ€ä¸å®é™…æ•°æ®ä¿æŒä¸€è‡´
      </div>
    </div>
  </div>

  <div class="test-section">
    <div class="test-title">ğŸ” æ§åˆ¶å°æ—¥å¿—</div>
    <div class="test-description">
      æ­£å¸¸æƒ…å†µä¸‹åº”è¯¥çœ‹åˆ°ä»¥ä¸‹æ—¥å¿—ï¼š
      <div class="code-block">
        // æ‰©å±•é‡è½½å‰<br>
        ä¿å­˜å•è¯æˆåŠŸ: [å•è¯]<br>
        <br>
        // æ‰©å±•é‡è½½åç«‹å³æ”¶è—<br>
        æ‰©å±•ä¸Šä¸‹æ–‡å¤±æ•ˆï¼Œå•è¯å·²ä¿å­˜åˆ°å†…å­˜: [å•è¯]<br>
        <br>
        // å‡ ç§’åè‡ªåŠ¨æ¢å¤<br>
        æ‰©å±•ä¸Šä¸‹æ–‡å·²æ¢å¤ï¼Œå°è¯•åŒæ­¥æ•°æ®...<br>
        æ•°æ®åŒæ­¥æˆåŠŸ
      </div>
    </div>
  </div>

  <div class="test-section">
    <div class="test-title">âš ï¸ æ³¨æ„äº‹é¡¹</div>
    <div class="test-steps">
      <div class="step">
        <span class="warning">!</span> é‡è½½æ‰©å±•ä¼šæš‚æ—¶ä¸­æ–­ä¸Chromeå­˜å‚¨çš„è¿æ¥
      </div>
      <div class="step">
        <span class="warning">!</span> æ•°æ®ä¼šå…ˆä¿å­˜åˆ°å†…å­˜ï¼Œç„¶åè‡ªåŠ¨åŒæ­¥åˆ°å­˜å‚¨
      </div>
      <div class="step">
        <span class="warning">!</span> æ¢å¤æ£€æµ‹æœ€å¤šè¿è¡Œ10åˆ†é’Ÿï¼Œé¿å…æ— é™å¾ªç¯
      </div>
      <div class="step">
        <span class="warning">!</span> å¦‚æœé¡µé¢åˆ·æ–°ï¼Œå†…å­˜ä¸­çš„æ•°æ®ä¼šä¸¢å¤±
      </div>
    </div>
  </div>

  <div class="test-section">
    <div class="test-title">ğŸ“ˆ æ”¹è¿›å¯¹æ¯”</div>
    <div class="test-description">
      <strong>v1.7.7 ä¹‹å‰ï¼š</strong>
      <ul>
        <li class="error">âŒ æ‰©å±•é‡è½½åæ”¶è—åŠŸèƒ½å®Œå…¨å¤±æ•ˆ</li>
        <li class="error">âŒ ç”¨æˆ·æ“ä½œä¸¢å¤±ï¼Œéœ€è¦é‡æ–°æ”¶è—</li>
        <li class="error">âŒ é”™è¯¯ä¿¡æ¯ä¸å‹å¥½ï¼Œç”¨æˆ·ä¸çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆ</li>
        <li class="error">âŒ æ²¡æœ‰æ¢å¤æœºåˆ¶ï¼Œéœ€è¦æ‰‹åŠ¨åˆ·æ–°é¡µé¢</li>
      </ul>
      
      <strong>v1.7.8 ç°åœ¨ï¼š</strong>
      <ul>
        <li class="success">âœ… æ‰©å±•é‡è½½ååŠŸèƒ½ä»å¯æ­£å¸¸ä½¿ç”¨</li>
        <li class="success">âœ… æ•°æ®æ™ºèƒ½ä¿æŠ¤ï¼Œä¸ä¼šä¸¢å¤±ç”¨æˆ·æ“ä½œ</li>
        <li class="success">âœ… å‹å¥½çš„çŠ¶æ€æç¤ºå’Œé”™è¯¯å¤„ç†</li>
        <li class="success">âœ… è‡ªåŠ¨æ¢å¤å’Œæ•°æ®åŒæ­¥æœºåˆ¶</li>
        <li class="success">âœ… UIçŠ¶æ€ä¸æ•°æ®ä¿æŒä¸€è‡´</li>
      </ul>
    </div>
  </div>

  <div class="test-section">
    <div class="test-title">ğŸ“ ç‰ˆæœ¬ä¿¡æ¯</div>
    <div class="test-description">
      <strong>ç‰ˆæœ¬ï¼š</strong> v1.7.8<br>
      <strong>æ›´æ–°æ—¥æœŸï¼š</strong> 2024-12-19<br>
      <strong>æ›´æ–°ç±»å‹ï¼š</strong> æ ¸å¿ƒåŠŸèƒ½ä¿®å¤<br>
      <strong>ä¸»è¦ä¿®å¤ï¼š</strong> Extension context invalidated é”™è¯¯
    </div>
  </div>

  <script>
    function reloadExtension() {
      console.log('æ¨¡æ‹Ÿæ‰©å±•é‡è½½...');
      alert('è¯·æ‰‹åŠ¨é‡è½½æ‰©å±•ï¼š\n1. æ‰“å¼€ chrome://extensions/\n2. æ‰¾åˆ°"å¤šå¤šè®°å•è¯"æ‰©å±•\n3. ç‚¹å‡»åˆ·æ–°æŒ‰é’®\n4. è¿”å›æ­¤é¡µé¢æµ‹è¯•æ”¶è—åŠŸèƒ½');
    }
    
    function checkConsole() {
      console.log('=== æ‰©å±•ä¸Šä¸‹æ–‡æµ‹è¯•æ—¥å¿— ===');
      console.log('è¯·æŸ¥çœ‹ä¸Šæ–¹çš„æ—¥å¿—ä¿¡æ¯');
      console.log('æ­£å¸¸æƒ…å†µä¸‹åº”è¯¥çœ‹åˆ°æ‰©å±•ä¸Šä¸‹æ–‡ç›¸å…³çš„æ—¥å¿—');
      alert('è¯·æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„æ—¥å¿—ä¿¡æ¯');
    }
    
    function testRecovery() {
      console.log('æµ‹è¯•æ¢å¤æœºåˆ¶...');
      console.log('å¦‚æœæ‰©å±•ä¸Šä¸‹æ–‡å¤±æ•ˆï¼Œåº”è¯¥ä¼šåœ¨5ç§’å†…å¼€å§‹æ¢å¤æ£€æµ‹');
      alert('æ¢å¤æœºåˆ¶ä¼šè‡ªåŠ¨è¿è¡Œï¼Œè¯·è§‚å¯Ÿæ§åˆ¶å°æ—¥å¿—');
    }
    
    // é¡µé¢åŠ è½½æ—¶çš„æç¤º
    console.log('æ‰©å±•ä¸Šä¸‹æ–‡å¤±æ•ˆä¿®å¤æµ‹è¯•é¡µé¢å·²åŠ è½½');
    console.log('è¯·æŒ‰ç…§é¡µé¢è¯´æ˜è¿›è¡Œæµ‹è¯•');
  </script>
</body>
</html> 