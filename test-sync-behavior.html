<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ‰©å±•åŒæ­¥è¡Œä¸ºæµ‹è¯•</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
    }
    
    .test-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      text-align: center;
      margin-bottom: 20px;
      border-radius: 10px;
    }
    
    .test-section {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }
    
    .test-section h3 {
      margin-top: 0;
      color: #495057;
    }
    
    .improvement-list {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
    }
    
    .improvement-list h4 {
      margin-top: 0;
      color: #155724;
    }
    
    .improvement-list ul {
      margin-bottom: 0;
    }
    
    .improvement-list li {
      margin-bottom: 8px;
      color: #155724;
    }
    
    .old-behavior {
      background: #f8d7da;
      border: 1px solid #f5c6cb;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
    }
    
    .old-behavior h5 {
      margin-top: 0;
      color: #721c24;
    }
    
    .new-behavior {
      background: #d1ecf1;
      border: 1px solid #bee5eb;
      border-radius: 8px;
      padding: 15px;
    }
    
    .new-behavior h5 {
      margin-top: 0;
      color: #0c5460;
    }
    
    .code-block {
      background: #f8f9fa;
      border: 1px solid #e9ecef;
      border-radius: 4px;
      padding: 12px;
      font-family: 'Courier New', monospace;
      font-size: 14px;
      margin: 10px 0;
      overflow-x: auto;
    }
    
    .log-example {
      background: #2d3748;
      color: #e2e8f0;
      border-radius: 4px;
      padding: 12px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      margin: 10px 0;
    }
    
    .log-old {
      color: #fc8181;
    }
    
    .log-new {
      color: #68d391;
    }
    
    .demo-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin: 20px 0;
    }
    
    .demo-btn {
      background: linear-gradient(135deg, #42a5f5 0%, #1e88e5 100%);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s ease;
      box-shadow: 0 2px 8px rgba(30,136,229,0.3);
    }
    
    .demo-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(30,136,229,0.4);
    }
    
    .status-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }
    
    .status-good {
      background: #28a745;
    }
    
    .status-bad {
      background: #dc3545;
    }
  </style>
</head>
<body>
  <div class="test-header">
    <h1>ğŸ”„ æ‰©å±•åŒæ­¥è¡Œä¸ºä¼˜åŒ–æµ‹è¯•</h1>
    <p>æµ‹è¯•æ–°çš„é¡µé¢æ¿€æ´»æ—¶åŒæ­¥æœºåˆ¶</p>
  </div>

  <div class="improvement-list">
    <h4>ğŸ¯ ä¼˜åŒ–å†…å®¹ï¼š</h4>
    <ul>
      <li>âœ… ç§»é™¤å®šæœŸæ£€æŸ¥æœºåˆ¶ï¼Œé¿å…ä¸å¿…è¦çš„æ—¥å¿—è¾“å‡º</li>
      <li>âœ… æ”¹ä¸ºé¡µé¢æ¿€æ´»æ—¶æ£€æŸ¥å¹¶åŒæ­¥ä¸€æ¬¡</li>
      <li>âœ… åŒæ­¥æˆåŠŸåç§»é™¤äº‹ä»¶ç›‘å¬å™¨ï¼Œé¿å…é‡å¤åŒæ­¥</li>
      <li>âœ… å¤§å¹…å‡å°‘æ§åˆ¶å°æ—¥å¿—å™ªéŸ³</li>
      <li>âœ… æå‡æ€§èƒ½ï¼Œå‡å°‘åå°èµ„æºæ¶ˆè€—</li>
    </ul>
  </div>

  <div class="test-section">
    <h3>ğŸ” è¡Œä¸ºå¯¹æ¯”</h3>
    
    <div class="old-behavior">
      <h5><span class="status-indicator status-bad"></span>æ—§è¡Œä¸ºï¼ˆé—®é¢˜ï¼‰ï¼š</h5>
      <p><strong>å®šæœŸæ£€æŸ¥æœºåˆ¶ï¼š</strong></p>
      <ul>
        <li>æ¯5ç§’æ£€æŸ¥ä¸€æ¬¡æ‰©å±•ä¸Šä¸‹æ–‡</li>
        <li>æŒç»­10åˆ†é’Ÿçš„æ£€æŸ¥å‘¨æœŸ</li>
        <li>æ£€æŸ¥æˆåŠŸå30ç§’åé‡æ–°å¼€å§‹æ£€æŸ¥</li>
        <li>äº§ç”Ÿå¤§é‡æ§åˆ¶å°æ—¥å¿—</li>
      </ul>
      
      <div class="log-example">
        <div class="log-old">// æ¯5ç§’è¾“å‡ºä¸€æ¬¡ï¼ŒæŒç»­10åˆ†é’Ÿ</div>
        <div>æ‰©å±•ä¸Šä¸‹æ–‡å·²æ¢å¤ï¼Œå°è¯•åŒæ­¥æ•°æ®...</div>
        <div>å•è¯è¯¦ç»†æ•°æ®ä¿å­˜æˆåŠŸ: 11 ä¸ªå•è¯</div>
        <div>ç¿»è¯‘ç¼“å­˜ä¿å­˜æˆåŠŸ: 13 ä¸ªå•è¯</div>
        <div>æ•°æ®åŒæ­¥æˆåŠŸ</div>
        <div class="log-old">// 30ç§’ååˆå¼€å§‹æ–°ä¸€è½®æ£€æŸ¥...</div>
      </div>
    </div>

    <div class="new-behavior">
      <h5><span class="status-indicator status-good"></span>æ–°è¡Œä¸ºï¼ˆä¼˜åŒ–ï¼‰ï¼š</h5>
      <p><strong>é¡µé¢æ¿€æ´»æ—¶åŒæ­¥ï¼š</strong></p>
      <ul>
        <li>åªåœ¨é¡µé¢è¢«æ¿€æ´»æ—¶æ£€æŸ¥ä¸€æ¬¡</li>
        <li>åŒæ­¥æˆåŠŸåç§»é™¤äº‹ä»¶ç›‘å¬å™¨</li>
        <li>é¿å…é‡å¤åŒæ­¥å’Œæ—¥å¿—è¾“å‡º</li>
        <li>å¤§å¹…å‡å°‘æ€§èƒ½æ¶ˆè€—</li>
      </ul>
      
      <div class="log-example">
        <div class="log-new">// åªåœ¨é¡µé¢æ¿€æ´»æ—¶è¾“å‡ºä¸€æ¬¡</div>
        <div>é¡µé¢æ¿€æ´»ï¼Œæ£€æŸ¥æ‰©å±•ä¸Šä¸‹æ–‡...</div>
        <div>æ‰©å±•ä¸Šä¸‹æ–‡å·²æ¢å¤ï¼Œå°è¯•åŒæ­¥æ•°æ®...</div>
        <div>å•è¯è¯¦ç»†æ•°æ®ä¿å­˜æˆåŠŸ: 11 ä¸ªå•è¯</div>
        <div>ç¿»è¯‘ç¼“å­˜ä¿å­˜æˆåŠŸ: 13 ä¸ªå•è¯</div>
        <div>æ•°æ®åŒæ­¥æˆåŠŸ</div>
        <div class="log-new">// ä¹‹åä¸å†æœ‰åŒæ­¥æ—¥å¿—</div>
      </div>
    </div>
  </div>

  <div class="test-section">
    <h3>ğŸ› ï¸ æŠ€æœ¯å®ç°</h3>
    
    <p><strong>æ–°çš„åŒæ­¥æœºåˆ¶ä½¿ç”¨ä»¥ä¸‹äº‹ä»¶ï¼š</strong></p>
    <ul>
      <li><code>visibilitychange</code> - é¡µé¢å¯è§æ€§å˜åŒ–</li>
      <li><code>focus</code> - çª—å£è·å¾—ç„¦ç‚¹</li>
    </ul>
    
    <div class="code-block">
// æ–°çš„å®ç°é€»è¾‘
function setupExtensionContextRecovery() {
  let hasTriedSync = false; // é˜²æ­¢é‡å¤åŒæ­¥
  
  function handleVisibilityChange() {
    if (!document.hidden && !hasTriedSync && !isExtensionContextValid()) {
      console.log('é¡µé¢æ¿€æ´»ï¼Œæ£€æŸ¥æ‰©å±•ä¸Šä¸‹æ–‡...');
      trySync();
    }
  }
  
  // åŒæ­¥æˆåŠŸåç§»é™¤äº‹ä»¶ç›‘å¬å™¨
  async function trySync() {
    if (hasTriedSync) return;
    // ... åŒæ­¥é€»è¾‘ ...
    // æˆåŠŸåç§»é™¤ç›‘å¬å™¨ï¼Œé¿å…åç»­æ£€æŸ¥
  }
}
    </div>
  </div>

  <div class="test-section">
    <h3>ğŸ“Š æ€§èƒ½æå‡</h3>
    
    <table style="width: 100%; border-collapse: collapse;">
      <tr style="background: #f8f9fa;">
        <th style="padding: 12px; border: 1px solid #dee2e6; text-align: left;">æŒ‡æ ‡</th>
        <th style="padding: 12px; border: 1px solid #dee2e6; text-align: left;">æ—§è¡Œä¸º</th>
        <th style="padding: 12px; border: 1px solid #dee2e6; text-align: left;">æ–°è¡Œä¸º</th>
        <th style="padding: 12px; border: 1px solid #dee2e6; text-align: left;">æ”¹å–„</th>
      </tr>
      <tr>
        <td style="padding: 12px; border: 1px solid #dee2e6;">æ£€æŸ¥é¢‘ç‡</td>
        <td style="padding: 12px; border: 1px solid #dee2e6;">æ¯5ç§’</td>
        <td style="padding: 12px; border: 1px solid #dee2e6;">é¡µé¢æ¿€æ´»æ—¶</td>
        <td style="padding: 12px; border: 1px solid #dee2e6; color: #28a745;">å¤§å¹…å‡å°‘</td>
      </tr>
      <tr style="background: #f8f9fa;">
        <td style="padding: 12px; border: 1px solid #dee2e6;">æ—¥å¿—è¾“å‡º</td>
        <td style="padding: 12px; border: 1px solid #dee2e6;">æŒç»­è¾“å‡º</td>
        <td style="padding: 12px; border: 1px solid #dee2e6;">ä¸€æ¬¡æ€§è¾“å‡º</td>
        <td style="padding: 12px; border: 1px solid #dee2e6; color: #28a745;">å‡å°‘90%+</td>
      </tr>
      <tr>
        <td style="padding: 12px; border: 1px solid #dee2e6;">CPUæ¶ˆè€—</td>
        <td style="padding: 12px; border: 1px solid #dee2e6;">æŒç»­æ¶ˆè€—</td>
        <td style="padding: 12px; border: 1px solid #dee2e6;">æŒ‰éœ€æ¶ˆè€—</td>
        <td style="padding: 12px; border: 1px solid #dee2e6; color: #28a745;">æ˜¾è‘—é™ä½</td>
      </tr>
      <tr style="background: #f8f9fa;">
        <td style="padding: 12px; border: 1px solid #dee2e6;">ç”¨æˆ·ä½“éªŒ</td>
        <td style="padding: 12px; border: 1px solid #dee2e6;">æ§åˆ¶å°å™ªéŸ³</td>
        <td style="padding: 12px; border: 1px solid #dee2e6;">æ¸…æ´æ—¥å¿—</td>
        <td style="padding: 12px; border: 1px solid #dee2e6; color: #28a745;">å¤§å¹…æå‡</td>
      </tr>
    </table>
  </div>

  <div class="demo-buttons">
    <button class="demo-btn" onclick="simulatePageActivation()">æ¨¡æ‹Ÿé¡µé¢æ¿€æ´»</button>
    <button class="demo-btn" onclick="showConsoleExample()">æŸ¥çœ‹æ§åˆ¶å°ç¤ºä¾‹</button>
    <button class="demo-btn" onclick="clearConsole()">æ¸…ç©ºæ§åˆ¶å°</button>
  </div>

  <div class="test-section">
    <h3>ğŸ‰ ä¼˜åŒ–æ•ˆæœ</h3>
    <p>é€šè¿‡è¿™æ¬¡ä¼˜åŒ–ï¼Œç”¨æˆ·å°†äº«å—åˆ°ï¼š</p>
    <ul>
      <li><strong>æ›´æ¸…æ´çš„æ§åˆ¶å°</strong> - ä¸å†æœ‰é¢‘ç¹çš„åŒæ­¥æ—¥å¿—</li>
      <li><strong>æ›´å¥½çš„æ€§èƒ½</strong> - å‡å°‘ä¸å¿…è¦çš„åå°æ£€æŸ¥</li>
      <li><strong>æ›´æ™ºèƒ½çš„åŒæ­¥</strong> - åªåœ¨éœ€è¦æ—¶è¿›è¡Œæ•°æ®åŒæ­¥</li>
      <li><strong>æ›´ç¨³å®šçš„ä½“éªŒ</strong> - é¿å…é‡å¤åŒæ­¥å¯¼è‡´çš„é—®é¢˜</li>
    </ul>
  </div>

  <script>
    function simulatePageActivation() {
      console.log('ğŸ”„ æ¨¡æ‹Ÿé¡µé¢æ¿€æ´»äº‹ä»¶...');
      console.log('é¡µé¢æ¿€æ´»ï¼Œæ£€æŸ¥æ‰©å±•ä¸Šä¸‹æ–‡...');
      console.log('æ‰©å±•ä¸Šä¸‹æ–‡å·²æ¢å¤ï¼Œå°è¯•åŒæ­¥æ•°æ®...');
      console.log('å•è¯è¯¦ç»†æ•°æ®ä¿å­˜æˆåŠŸ: 11 ä¸ªå•è¯');
      console.log('ç¿»è¯‘ç¼“å­˜ä¿å­˜æˆåŠŸ: 13 ä¸ªå•è¯');
      console.log('æ•°æ®åŒæ­¥æˆåŠŸ');
      console.log('âœ… åŒæ­¥å®Œæˆï¼Œç§»é™¤äº‹ä»¶ç›‘å¬å™¨');
      
      alert('âœ… é¡µé¢æ¿€æ´»åŒæ­¥æ¼”ç¤ºå®Œæˆï¼\n\næ–°è¡Œä¸ºç‰¹ç‚¹ï¼š\nâ€¢ åªåœ¨é¡µé¢æ¿€æ´»æ—¶åŒæ­¥ä¸€æ¬¡\nâ€¢ åŒæ­¥åç§»é™¤ç›‘å¬å™¨\nâ€¢ ä¸å†æœ‰é‡å¤çš„æ—¥å¿—è¾“å‡º\n\nè¯·æŸ¥çœ‹æ§åˆ¶å°äº†è§£è¯¦ç»†æ—¥å¿—');
    }
    
    function showConsoleExample() {
      console.group('ğŸ“Š æ–°æ—§è¡Œä¸ºå¯¹æ¯”');
      
      console.group('âŒ æ—§è¡Œä¸ºï¼ˆæ¯5ç§’é‡å¤ï¼‰');
      console.log('%cæ‰©å±•ä¸Šä¸‹æ–‡å·²æ¢å¤ï¼Œå°è¯•åŒæ­¥æ•°æ®...', 'color: #dc3545');
      console.log('%cå•è¯è¯¦ç»†æ•°æ®ä¿å­˜æˆåŠŸ: 11 ä¸ªå•è¯', 'color: #dc3545');
      console.log('%cç¿»è¯‘ç¼“å­˜ä¿å­˜æˆåŠŸ: 13 ä¸ªå•è¯', 'color: #dc3545');
      console.log('%cæ•°æ®åŒæ­¥æˆåŠŸ', 'color: #dc3545');
      console.log('%cï¼ˆ5ç§’åé‡å¤...ï¼‰', 'color: #dc3545; font-style: italic');
      console.groupEnd();
      
      console.group('âœ… æ–°è¡Œä¸ºï¼ˆé¡µé¢æ¿€æ´»æ—¶ä¸€æ¬¡ï¼‰');
      console.log('%cé¡µé¢æ¿€æ´»ï¼Œæ£€æŸ¥æ‰©å±•ä¸Šä¸‹æ–‡...', 'color: #28a745');
      console.log('%cæ‰©å±•ä¸Šä¸‹æ–‡å·²æ¢å¤ï¼Œå°è¯•åŒæ­¥æ•°æ®...', 'color: #28a745');
      console.log('%cå•è¯è¯¦ç»†æ•°æ®ä¿å­˜æˆåŠŸ: 11 ä¸ªå•è¯', 'color: #28a745');
      console.log('%cç¿»è¯‘ç¼“å­˜ä¿å­˜æˆåŠŸ: 13 ä¸ªå•è¯', 'color: #28a745');
      console.log('%cæ•°æ®åŒæ­¥æˆåŠŸ', 'color: #28a745');
      console.log('%cï¼ˆä¹‹åä¸å†é‡å¤ï¼‰', 'color: #28a745; font-style: italic');
      console.groupEnd();
      
      console.groupEnd();
    }
    
    function clearConsole() {
      console.clear();
      console.log('ğŸ§¹ æ§åˆ¶å°å·²æ¸…ç©º');
    }
    
    // é¡µé¢åŠ è½½å®Œæˆåæ˜¾ç¤ºè¯´æ˜
    document.addEventListener('DOMContentLoaded', () => {
      setTimeout(() => {
        alert('ğŸ‰ æ‰©å±•åŒæ­¥è¡Œä¸ºä¼˜åŒ–å®Œæˆï¼\n\nä¸»è¦æ”¹è¿›ï¼š\nâ€¢ ç§»é™¤å®šæœŸæ£€æŸ¥ï¼Œæ”¹ä¸ºé¡µé¢æ¿€æ´»æ—¶åŒæ­¥\nâ€¢ å¤§å¹…å‡å°‘æ§åˆ¶å°æ—¥å¿—è¾“å‡º\nâ€¢ æå‡æ€§èƒ½ï¼Œå‡å°‘èµ„æºæ¶ˆè€—\nâ€¢ é¿å…é‡å¤åŒæ­¥\n\nç‚¹å‡»æŒ‰é’®ä½“éªŒæ–°çš„åŒæ­¥è¡Œä¸ºï¼');
      }, 500);
    });
  </script>
</body>
</html> 